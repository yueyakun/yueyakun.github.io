(window.webpackJsonp=window.webpackJsonp||[]).push([[31],{514:function(t,a,r){"use strict";r.r(a);var s=r(4),v=Object(s.a)({},(function(){var t=this,a=t.$createElement,r=t._self._c||a;return r("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[r("h2",{attrs:{id:"缓存穿透"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#缓存穿透"}},[t._v("#")]),t._v(" 缓存穿透")]),t._v(" "),r("h3",{attrs:{id:"发生原因"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#发生原因"}},[t._v("#")]),t._v(" 发生原因")]),t._v(" "),r("p",[t._v("缓存和DB中都没有命中数据。产生的原因可能是外部恶意的频繁访问不存在的数据，导致大量请求落到DB。\n比如数据的id大于零的，查询一个id为负数的数据时肯定就会发生缓存穿透。")]),t._v(" "),r("h3",{attrs:{id:"解决方法"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#解决方法"}},[t._v("#")]),t._v(" 解决方法")]),t._v(" "),r("ul",[r("li",[r("p",[t._v("对参数做校验，不合法的参数直接return。")])]),t._v(" "),r("li",[r("p",[t._v("对null也进行缓存（存'空'），但是可能会导致缓存中有大量无用的数据。")])]),t._v(" "),r("li",[r("p",[t._v("在查询方法前增加使用布隆过滤器，判断key是否在数据库中存在，不存在直接返回。")])])]),t._v(" "),r("h2",{attrs:{id:"缓存击穿"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#缓存击穿"}},[t._v("#")]),t._v(" 缓存击穿")]),t._v(" "),r("h3",{attrs:{id:"发生原因-2"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#发生原因-2"}},[t._v("#")]),t._v(" 发生原因")]),t._v(" "),r("p",[t._v("就是某个热点数据失效时，大量针对这个数据的查询会落到DB中。")]),t._v(" "),r("h3",{attrs:{id:"解决方法-2"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#解决方法-2"}},[t._v("#")]),t._v(" 解决方法")]),t._v(" "),r("ul",[r("li",[r("p",[t._v("加互斥锁：当从缓存中没有命中时，进行非空判断，不要立即去DB查找，先获取锁，获取成功则进入DB查找，否则重试整个获取缓存的方法，最后使用try catch finally 进行一场处理，释放锁，这样可以保证只有一个线程进入db查询。")])]),t._v(" "),r("li",[r("p",[t._v("对热点数据不设置过期时间，修改后更新缓存即可。")])])]),t._v(" "),r("h2",{attrs:{id:"缓存雪崩"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#缓存雪崩"}},[t._v("#")]),t._v(" 缓存雪崩")]),t._v(" "),r("h3",{attrs:{id:"发生原因-3"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#发生原因-3"}},[t._v("#")]),t._v(" 发生原因")]),t._v(" "),r("p",[t._v("同一时间缓存大面积失效，巨大查询量落到DB，DB压力过大导致宕机、崩掉。")]),t._v(" "),r("h3",{attrs:{id:"解决方法-3"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#解决方法-3"}},[t._v("#")]),t._v(" 解决方法")]),t._v(" "),r("ul",[r("li",[r("p",[t._v("把每个key的过期时间都加上一个随机值，这样可以一定程度上避免同一时刻缓存大面积失效。")])]),t._v(" "),r("li",[r("p",[t._v("对热点数据不设置过期时间，修改后更新缓存即可。")])])]),t._v(" "),r("h2",{attrs:{id:"总结"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[t._v("#")]),t._v(" 总结")]),t._v(" "),r("p",[t._v("穿透：指缓存和DB中都不存在的数据，每次都绕过缓存，直接落到数据库")]),t._v(" "),r("p",[t._v("击穿：某个热点key失效，失效瞬间，导致大量请求对这一个点进行访问，穿过了缓存，落到数据库")]),t._v(" "),r("p",[t._v("雪崩：大面积的缓存失效，大量请求落到数据库")])])}),[],!1,null,null,null);a.default=v.exports}}]);