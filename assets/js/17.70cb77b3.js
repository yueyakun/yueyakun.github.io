(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{503:function(t,a,s){"use strict";s.r(a);var r=s(4),e=Object(r.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("p",[t._v("实时、可视化的监控线上运行的 Spring Boot 应用是保障应用健康运行的关键。Actuator + Prometheus + Grafana 的组合可以十分方便的实现线上应用监控。")]),t._v(" "),s("h2",{attrs:{id:"prometheus-简介"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#prometheus-简介"}},[t._v("#")]),t._v(" Prometheus 简介")]),t._v(" "),s("p",[t._v("Prometheus 是由 SoundCloud 开源监控告警解决方案，2012 年开始编写代码，2015 年在 github 上开源。2016 年 Prometheus 成为继 k8s 后，第二名 CNCF("),s("a",{attrs:{href:"https://www.cncf.io/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Cloud Native Computing Foundation"),s("OutboundLink")],1),t._v(") 成员.")]),t._v(" "),s("p",[t._v("主要功能和架构原理请参考 "),s("a",{attrs:{href:"https://prometheus.io/docs/introduction/overview/",target:"_blank",rel:"noopener noreferrer"}},[t._v("官方文档"),s("OutboundLink")],1),t._v(" 或者 gitbooks 上的 "),s("a",{attrs:{href:"https://songjiayang.gitbooks.io/prometheus/content/introduction/what.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Prometheus 实战"),s("OutboundLink")],1),t._v(" 或者 "),s("a",{attrs:{href:"https://yunlzheng.gitbook.io/prometheus-book/part-ii-prometheus-jin-jie/grafana/grafana-intro",target:"_blank",rel:"noopener noreferrer"}},[t._v("Prometheus book"),s("OutboundLink")],1)]),t._v(" "),s("h2",{attrs:{id:"grafana-简介"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#grafana-简介"}},[t._v("#")]),t._v(" Grafana 简介")]),t._v(" "),s("p",[t._v("Grafana 是一套开源的分析监视平台，支持 Graphite, InfluxDB, OpenTSDB, Prometheus, Elasticsearch, CloudWatch 等数据源，其 UI 非常漂亮且高度定制化。")]),t._v(" "),s("p",[t._v("详细信息可以移步 "),s("a",{attrs:{href:"https://grafana.com/docs/grafana/latest/",target:"_blank",rel:"noopener noreferrer"}},[t._v("官方网站"),s("OutboundLink")],1),t._v(" 或者 "),s("a",{attrs:{href:"https://www.jianshu.com/p/7e7e0d06709b",target:"_blank",rel:"noopener noreferrer"}},[t._v("Grafana 全面瓦解"),s("OutboundLink")],1)]),t._v(" "),s("h2",{attrs:{id:"在应用中引入-actuator"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#在应用中引入-actuator"}},[t._v("#")]),t._v(" 在应用中引入 Actuator")]),t._v(" "),s("p",[t._v("关于 Actuator 的使用上篇已经讲过，地址："),s("a",{attrs:{href:"https://yueyakun.github.io//2020/06/05/spring-boot-actuator/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Spring Boot Actuator 使用详解"),s("OutboundLink")],1)]),t._v(" "),s("h2",{attrs:{id:"在项目中引入-prometheus"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#在项目中引入-prometheus"}},[t._v("#")]),t._v(" 在项目中引入 Prometheus")]),t._v(" "),s("ol",[s("li",[t._v("在 pom 文件中引入依赖")])]),t._v(" "),s("div",{staticClass:"language-xml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-xml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("io.micrometer"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("micrometer-registry-prometheus"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),s("ol",{attrs:{start:"2"}},[s("li",[t._v("放开 Actuator 的 /prometheus 端点")])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("management")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("endpoints")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n   "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("web")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n     "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("exposure")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n       "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("include")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" prometheus\n")])])]),s("ol",{attrs:{start:"3"}},[s("li",[t._v("增加配置类")])]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Bean")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MeterRegistryCustomizer")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MeterRegistry")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("configurer")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Value")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"${spring.application.name}"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" applicationName"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("registry"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v(" registry"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("config")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("commonTags")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"application"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" applicationName"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("ol",{attrs:{start:"4"}},[s("li",[t._v("访问 HTTP 端口，测试端点状态")])]),t._v(" "),s("p",[t._v("http://localhost:8083/actuator/prometheus")]),t._v(" "),s("h2",{attrs:{id:"centos7-安装配置-prometheus"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#centos7-安装配置-prometheus"}},[t._v("#")]),t._v(" CentOS7 安装配置 Prometheus")]),t._v(" "),s("p",[t._v("具体安装配置步骤见我的这篇博客："),s("a",{attrs:{href:""}},[t._v("CentOS7 安装配置 Prometheus")])]),t._v(" "),s("p",[t._v("安装成功后访问 http://ip:9090 就能看到如下界面")]),t._v(" "),s("p",[s("img",{attrs:{src:"/posts/2020-06-08-prometheus-and-grafana/01.png",alt:""}})]),t._v(" "),s("p",[t._v("prometheus 的界面也能实现简单的运行信息图形化显示，但是一般不推荐。没 Grafana 的 UI 好用。")]),t._v(" "),s("h2",{attrs:{id:"centos7-安装配置-grafana"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#centos7-安装配置-grafana"}},[t._v("#")]),t._v(" CentOS7 安装配置 Grafana")]),t._v(" "),s("p",[t._v("具体安装配置步骤见我的这篇博客："),s("a",{attrs:{href:""}},[t._v("CentOS7 安装配置 Grafana")])]),t._v(" "),s("p",[t._v("安装成功后访问 http://ip:3000 ，默认用户名和密码都是 admin，首次登录会提示重置密码。")]),t._v(" "),s("h2",{attrs:{id:"设置数据源"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#设置数据源"}},[t._v("#")]),t._v(" 设置数据源")]),t._v(" "),s("p",[t._v("登录后点击左侧菜单中的齿轮打开 config 页面，点击页面中的 add data source 按钮，如下图")]),t._v(" "),s("p",[s("img",{attrs:{src:"/posts/2020-06-08-prometheus-and-grafana/02.png",alt:""}})]),t._v(" "),s("p",[t._v("数据源类型选择 prometheus")]),t._v(" "),s("p",[s("img",{attrs:{src:"/posts/2020-06-08-prometheus-and-grafana/03.png",alt:""}})]),t._v(" "),s("p",[t._v("输入数据源名称和 url 地址，如果没有 auth 逻辑直接点击下面的 save and test 按钮就 ok 了。")]),t._v(" "),s("p",[s("img",{attrs:{src:"/posts/2020-06-08-prometheus-and-grafana/04.png",alt:""}})]),t._v(" "),s("h2",{attrs:{id:"导入监视面板"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#导入监视面板"}},[t._v("#")]),t._v(" 导入监视面板")]),t._v(" "),s("p",[t._v("监视面板可以自己创建，也可以选择导入。导入方法如下：")]),t._v(" "),s("ol",[s("li",[t._v("在 Grafana 的面板市场选择自己需要的面板模板，面板市场可以按名字、数据源类型等条件进行筛选，这里推荐人气最高的 "),s("a",{attrs:{href:"https://grafana.com/grafana/dashboards/4701",target:"_blank",rel:"noopener noreferrer"}},[t._v("JVM (Micrometer) "),s("OutboundLink")],1),t._v(",ID 是 4701 。")])]),t._v(" "),s("p",[s("img",{attrs:{src:"/posts/2020-06-08-prometheus-and-grafana/05.png",alt:""}})]),t._v(" "),s("p",[t._v("点击 + 号菜单中的 import 选项")]),t._v(" "),s("p",[s("img",{attrs:{src:"/posts/2020-06-08-prometheus-and-grafana/06.png",alt:""}})]),t._v(" "),s("p",[t._v("输入面板 ID 点击 load 按钮")]),t._v(" "),s("p",[s("img",{attrs:{src:"/posts/2020-06-08-prometheus-and-grafana/07.png",alt:""}})]),t._v(" "),s("p",[t._v("修改面板名称，选择数据源，点击 import 按钮就完成面板导入了。")]),t._v(" "),s("p",[s("img",{attrs:{src:"/posts/2020-06-08-prometheus-and-grafana/08.png",alt:""}})]),t._v(" "),s("p",[t._v("OK !! 接下来就可以愉快的监控 Spring Boot 服务运行状态了！")]),t._v(" "),s("h2",{attrs:{id:"参考文档："}},[s("a",{staticClass:"header-anchor",attrs:{href:"#参考文档："}},[t._v("#")]),t._v(" 参考文档：")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://juejin.im/post/5e27acf6e51d4557ea363a65",target:"_blank",rel:"noopener noreferrer"}},[t._v("Spring Boot 微服务应用集成Prometheus + Grafana 实现监控告警"),s("OutboundLink")],1)]),t._v(" "),s("p",[s("a",{attrs:{href:"https://yunlzheng.gitbook.io/prometheus-book/",target:"_blank",rel:"noopener noreferrer"}},[t._v("prometheus-book"),s("OutboundLink")],1)]),t._v(" "),s("p",[s("a",{attrs:{href:"https://legacy.gitbook.com/book/songjiayang/prometheus",target:"_blank",rel:"noopener noreferrer"}},[t._v("Prometheus 实战"),s("OutboundLink")],1)])])}),[],!1,null,null,null);a.default=e.exports}}]);