(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{503:function(t,s,a){"use strict";a.r(s);var e=a(4),n=Object(e.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("p",[t._v("二进制包安装 Prometheus")]),t._v(" "),a("h3",{attrs:{id:"_1、创建一个专用目录、进入目录"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1、创建一个专用目录、进入目录"}},[t._v("#")]),t._v(" 1、创建一个专用目录、进入目录")]),t._v(" "),a("p",[t._v("mkdir prometheus")]),t._v(" "),a("p",[t._v("cd prometheus")]),t._v(" "),a("h3",{attrs:{id:"_2、下载安装包"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2、下载安装包"}},[t._v("#")]),t._v(" 2、下载安装包")]),t._v(" "),a("p",[t._v("wget https://github.com/prometheus/prometheus/releases/download/v2.18.1/prometheus-2.18.1.linux-amd64.tar.gz")]),t._v(" "),a("h3",{attrs:{id:"_3、解压安装包、进入prometheus程序目录"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3、解压安装包、进入prometheus程序目录"}},[t._v("#")]),t._v(" 3、解压安装包、进入prometheus程序目录")]),t._v(" "),a("p",[t._v("tar -xvzf ~/Download/prometheus-2.18.1.linux-amd64.tar.gz")]),t._v(" "),a("p",[t._v("cd prometheus-2.18.1.linux-amd64")]),t._v(" "),a("h3",{attrs:{id:"_4、检查运行环境"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4、检查运行环境"}},[t._v("#")]),t._v(" 4、检查运行环境")]),t._v(" "),a("p",[t._v("./prometheus version")]),t._v(" "),a("h3",{attrs:{id:"_5、运行"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5、运行"}},[t._v("#")]),t._v(" 5、运行")]),t._v(" "),a("p",[t._v("//从程序根目录默认配置启动\n./prometheus")]),t._v(" "),a("p",[t._v('//指定配置文件和数据存储位置\n./prometheus --config.file=prometheus.yml --storage.tsdb.path="data/"')]),t._v(" "),a("h3",{attrs:{id:"_6、浏览器访问"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6、浏览器访问"}},[t._v("#")]),t._v(" 6、浏览器访问")]),t._v(" "),a("p",[t._v("http://ip:9090/")]),t._v(" "),a("h3",{attrs:{id:"_7、一个简单的配置文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7、一个简单的配置文件"}},[t._v("#")]),t._v(" 7、一个简单的配置文件")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# my global config")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("global")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("scrape_interval")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("     15s "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Set the scrape interval to every 15 seconds. Default is every 1 minute.")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("evaluation_interval")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 15s "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Evaluate rules every 15 seconds. The default is every 1 minute.")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# scrape_timeout is set to the global default (10s).")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Alertmanager configuration")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("alerting")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("alertmanagers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("static_configs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("targets")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# - alertmanager:9093")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Load rules once and periodically evaluate them according to the global 'evaluation_interval'.")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("rule_files")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# - "first_rules.yml"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# - "second_rules.yml"')]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# A scrape configuration containing exactly one endpoint to scrape:")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Here it's Prometheus itself.")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("scrape_configs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# The job name is added as a label `job=<job_name>` to any timeseries scraped from this config.")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("job_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'prometheus'")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# metrics_path defaults to '/metrics'")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# scheme defaults to 'http'.")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("static_configs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("targets")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'localhost:9090'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("job_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'goods-service'")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("scrape_interval")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 5s\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metrics_path")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/actuator/prometheus'")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("static_configs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("targets")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'127.0.0.1:8082'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("job_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'house-service'")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("scrape_interval")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 5s\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metrics_path")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/actuator/prometheus'")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("basic_auth")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("username")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'yyk'")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("password")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'123'")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("static_configs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("targets")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'127.0.0.1:8083'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),a("h3",{attrs:{id:"_8、配置热加载"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_8、配置热加载"}},[t._v("#")]),t._v(" 8、配置热加载")]),t._v(" "),a("p",[t._v("curl -X POST http://ip:9090/-/reload")]),t._v(" "),a("p",[t._v("需要在 Prometheus启动的时候加 --web.enable-lifecycle 参数，才能通过 http 接口实现热加载")]),t._v(" "),a("h3",{attrs:{id:"创建-systemd-服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建-systemd-服务"}},[t._v("#")]),t._v(" 创建 Systemd 服务")]),t._v(" "),a("p",[t._v("二进制包安装的 Prometheus 服务化需要进行以下操作")]),t._v(" "),a("ol",[a("li",[t._v("在 /etc/systemd/system/ 目录创建 prometheus.service 文件，文件内容如下:")])]),t._v(" "),a("blockquote",[a("p",[t._v("[Unit]\nDescription=Prometheus"),a("br"),t._v("\nDocumentation=https://prometheus.io/"),a("br"),t._v("\nAfter=network.target"),a("br"),t._v("\n[Service]"),a("br"),t._v("\nType=simple"),a("br"),t._v("\nUser=root"),a("br"),t._v("\nExecStart=/usr/local/prometheus/prometheus --config.file=/usr/local/prometheus/prometheus.yml --storage.tsdb.path=/data/prometheus"),a("br"),t._v("\nRestart=on-failure"),a("br"),t._v("\n[Install]"),a("br"),t._v("\nWantedBy=multi-user.target")])]),t._v(" "),a("p",[t._v("只需修改 ExecStart 项的 prometheus 启动命令地址、配置文件地址和数据存储位置地址即可。")]),t._v(" "),a("ol",{attrs:{start:"2"}},[a("li",[t._v("重启加载 Systemd")])]),t._v(" "),a("p",[t._v("systemctl daemon-reload")]),t._v(" "),a("ol",{attrs:{start:"3"}},[a("li",[t._v("启动 prometheus")])]),t._v(" "),a("p",[t._v("systemctl start prometheus")]),t._v(" "),a("ol",{attrs:{start:"4"}},[a("li",[t._v("查看状态")])]),t._v(" "),a("p",[t._v("systemctl status prometheus")]),t._v(" "),a("p",[t._v("参考资料：")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://www.jianshu.com/p/967cb76cd5ca",target:"_blank",rel:"noopener noreferrer"}},[t._v("Centos7 安装部署 Prometheus + Grafana"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://yunlzheng.gitbook.io/prometheus-book/parti-prometheus-ji-chu/quickstart/prometheus-quick-start/install-prometheus-server",target:"_blank",rel:"noopener noreferrer"}},[t._v("prometheus-book"),a("OutboundLink")],1)])])}),[],!1,null,null,null);s.default=n.exports}}]);